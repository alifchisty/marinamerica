<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>

    <title>Babylon</title>
</head>
<style>
    * {
        margin: 0;
        padding: 0;
    }

   body {
    height: 100vh;
    display: flex;
    flex-direction: column;
    color: #fff;
    background-image: url('mirror/new-bg-abstarct.jpg');
    background-repeat: no-repeat;
    background-size: cover;
    background-position: top;

    /* Pseudo-element to create the repeat effect after 100vh */
    position: relative;
}




   .logo-img {
          height: 7vh;
    margin-right: -45px;
    margin-left: -51px;
    margin-top: -2vh;
}

 
  .navclass {
    display: flex;
    background-size: auto;
text-align: center;
    height: 6vh;
    box-shadow: 4px 0 10px rgb(0, 0, 0);
position: sticky;
top: 0;
  backdrop-filter: blur(2px);
z-index:1001;
    padding-top: 3vh;
  }


    .chake-info {
        color: rgb(146, 146, 202);
    }

    .deposit-container {
        display: flex;
        flex-direction: column;
        margin: auto;
        font-size: 1.2rem;
    }


    @media screen and (max-width: 500px) {
        .deposit-container {
            display: flex;
            flex-direction: column;
            margin: auto 3vw;
            font-size: 1.2rem;
        }

    }

    /* Popup styling */
    .unique-popup {
        visibility: hidden;
        background-color: #4CAF50;
        color: white;
        text-align: center;
        padding: 5px;
        position: absolute;
        top: 50px;
        /* Adjust if needed */
        left: 50%;
        transform: translateX(-50%);
        border-radius: 5px;
        z-index: 1;
    }

    .unique-popup.show {
        visibility: visible;
    }

    /* Error message styling */
    .unique-error-message {
        color: red;
        visibility: hidden;
        margin-top: 5px;
    }


    #unique-deposit-input {
        padding: 8px;
        border-radius: 5px;
        border: 2px solid gold;
        margin: 3px 0;
        width: 100%;
        text-align: center;
        padding-right: 30px;
        box-sizing: border-box;
        color: rgb(64, 64, 202);
        background-color: cornsilk;
    }

    .binance-container {
        margin: 10px 0px;
    }

    .pakage-chake>input {
        padding: 4px;
        margin: 1px 0;
        color: #fd1d1d;
    }

    #userid {
        border: none;
        padding: 8px;
        border-radius: 5px
    }

    .request-for-deposit>button {
        padding: 8px 15px;
        border-radius: 4px;
        border: none;
        background-color: rgb(15, 219, 15);
        color: #fffff9;
        margin: 1vh;
    }

    .request-for-deposit>button:hover {
        background-color: blue;
    }
.chakeDeposit{
display: none;
}
   
        /* Container fixed at the bottom */
        .container {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            /* Full width */
            margin-top: 71vh;
            padding: 0;
            box-shadow: 0 -3px 7px rgba(0, 0, 0, 0.3);
            /* Shadow for subtle effect */
            background-color: #fff;
            /* Background color */
            z-index: 1000;
            /* Ensure it is above other content */
            line-height: 99%;
        }

        /* Layer within the container for alignment */
        .container-layer {
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 7px 0;
            background-color: #fff;
            /* Ensure background color matches container */
        }

        /* Styling for clickable items */
        .clk {
            color: black;
            text-decoration: none;
            padding: 3px;
            margin: 0 auto;
            text-align: center;
        }

        i {
            font-size: 2rem;
            margin: 0 auto;
        }

        .clicked-icon {
            color: rgb(0, 255, 234);
            /* Ensure the icon remains readable */
        }


        .mine-btn>.arow>i {
            font-size: 1rem;
            margin: 0 auto;
        }
</style>

<body>
    <nav class="navclass">
                <img class="logo-img" src="mirror/logo2.png" alt="" srcset="">
    
  </nav>
    <div class="deposit-container">

        <!-- {{!--
        <div class="deposit-container">
            <div class="deposit-container">
                <div class="binance-container">
                    <p class="binance">1. Send deposit request money in this Binance link</p>
                    <input type="text" value="TKJbdBFhDM36sPiBAxWPoSg9bBv4brvKUWj" id="deposit" readonly
                        onclick="copyDepositId()">
                    <p id="error-message" class="error-message"></p>
                </div>
                <div id="popup" class="popup">Copied!</div>
            </div> --}} -->

        <div class="unique-deposit-container deposit-container">
            <div class="unique-binance-container binance-container">
                <p class="unique-binance binance" style="color: rgb\(146, 146, 202;color: rgb(146, 146, 202);">1. Send USDT using Crypto Network(TRC20).</p>
<input type="text"
                    value="TXX8go3jK6xVsm8DTAwQVT4W5cYx356tWC" id="unique-deposit-input" readonly
                    onclick="copyDepositId()">
                <div class="unique-popup" id="unique-popup">Copied!</div>
                <p id="unique-error-message" class="unique-error-message"></p>
            </div>
        </div>

        <p class="chake-info">2. Confirmed checked <input type="checkbox" checked> your deposit request</p>
        <div class="pakage-chake">
            <input type="checkbox" name="package" id="silver">
            <input type="text" value="90$" readonly>
        </div>
        <div class="pakage-chake">
            <input type="checkbox" name="package" id="gold">
            <input type="text" value="180$" readonly>
        </div>
        <div class="pakage-chake">
            <input type="checkbox" name="package" id="dimond">
            <input type="text" value="300$" readonly>
        </div>
        <div class="pakage-chake">
            <input type="checkbox" name="package" id="Platinum">
            <input type="text" value="600$" readonly>
        </div>
        <div class="request-for-deposit">
            <input type="text" placeholder="Enter user_id" id="displayUserId">
            <button type="button" onclick="requestDeposit()">Deposit</button>
        </div>
        <button type="button" class="chakeDeposit" id="check-deposit">
            <p id="Chake-depositt">Check Deposit</p>
        </button>

    </div>

    <p id="electronic" style="font-size: 1.2rem;color: blue;"></p>
 <footer class="container">
        <nav class="container-layer">
            <a href="/Home" class="clk"> <i class='bx bxs-home' style='color:#0c0400'></i><br>Home</a>
            <a href="/Connection" class="clk"> <i class='bx bx-sitemap' class="clkk"></i> <br> Network</a>
            <a href="/vip" class="clk vip-link"><i class='bx bxl-sketch' style='color:#0c0c0c'></i><br>Invest</a>
            <a href="/Mine" class="clk"><i class='bx bxs-user' style='color:#000400'></i><br>Owner</a>
            <a href="/about" class="clk"><i class='bx bx-shield'></i><br>About</a>
        </nav>
    </footer>
    <script>
        const depositInput = document.getElementById('unique-deposit-input');
        const popup = document.getElementById('unique-popup');
        const errorMessage = document.getElementById('unique-error-message');
        const correctDepositId = "TXX8go3jK6xVsm8DTAwQVT4W5cYx356tWC";

        function copyDepositId() {
            depositInput.select();
            depositInput.setSelectionRange(0, 99999); // For mobile devices
            navigator.clipboard.writeText(depositInput.value);

            popup.classList.add('show');
            setTimeout(() => popup.classList.remove('show'), 500);
        }

        depositInput.addEventListener('input', () => {
            if (depositInput.value !== correctDepositId) {
                errorMessage.textContent = "Your deposit ID is now incorrect";
                errorMessage.style.visibility = "visible";
            } else {
                errorMessage.style.visibility = "hidden";
            }
        });

    </script>

    <script>document.addEventListener('DOMContentLoaded', function () {
            const urlParams = new URLSearchParams(window.location.search);
            const deposituserId = urlParams.get('deposituserId');

            if (deposituserId) {
                localStorage.setItem('userId', deposituserId);
                document.getElementById('displayUserId').value = deposituserId;
                checkUserDeposits(deposituserId); // Function to check and display user deposits
            } else {
                const userId = localStorage.getItem('userId');
                if (userId) {
                    document.getElementById('displayUserId').value = userId;
                    checkUserDeposits(userId); // Function to check and display user deposits
                } else {
                    alert('User information not found. Please log in again.');
                    window.location.href = '/login';
                    return;
                }
            }

            const packages = ["silver", "gold", "dimond", "Platinum"];
            packages.forEach(pkg => {
                document.getElementById(pkg).addEventListener('change', (event) => {
                    if (event.target.checked) {
                        packages.forEach(otherPkg => {
                            if (otherPkg !== pkg) {
                                document.getElementById(otherPkg).checked = false;
                            }
                        });
                    }
                });
            });

            document.getElementById('check-deposit').addEventListener('click', requestDeposit);

            document.querySelector('.vip-link').addEventListener('click', (event) => {
                event.preventDefault();

                const vipuserId = localStorage.getItem('userId');
                if (vipuserId) {
                    window.location.href = `/vip?vipuserId=${vipuserId}`;
                } else {
                    alert('Invalid user ID');
                }
            });

            // Display the electronic value in dollars and cents
            displayElectronicValue();
        });

        async function requestDeposit() {
    const packages = ["silver", "gold", "dimond", "Platinum"];
    let selectedPackage = null;

    for (const pkg of packages) {
        if (document.getElementById(pkg).checked) {
            selectedPackage = pkg;
            break;
        }
    }

    if (!selectedPackage) {
        showPopupMessage('Please select at least one package.', false, 1000);
        return;
    }

    const userId = document.getElementById('displayUserId').value;

    if (userId !== localStorage.getItem('userId')) {
        alert("User ID does not match.");
        return;
    }

    showPopupMessage('Binance Transaction ID (TXID).', true);

    document.querySelector('.popup-form').addEventListener('submit', async (event) => {
        event.preventDefault();

        const input = document.querySelector('.popup-form input').value.trim();
        if (!input) {
            showPopupMessage('Your text is null', false, 1000);
            return;
        }

        try {
            const response = await fetch('/deposit-request', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ package: selectedPackage, userId: userId, details: input }),
            });

            const data = await response.json();

            if (response.ok) {
                showPopupMessage('Successful deposit request', false, 1000);

                // Update the displayed electronic value
                const updatedElectronic = data.deposit[data.deposit.length - 1].electronic; // Get updated electronic value from the latest deposit entry
                localStorage.setItem('electronic', updatedElectronic); // Store it in local storage
                document.getElementById('electronic').textContent = `Electronic: ${updatedElectronic}`; // Update UI
            } else {
                alert(data.error || 'An error occurred');
            }
        } catch (error) {
            alert('An error occurred while processing your request. Please try again later.');
        }
    });
}

        function showPopupMessage(message, showForm = false, removeAfter = 0) {
            const existingPopup = document.querySelector('.popup');
            if (existingPopup) {
                existingPopup.remove();
            }

            const popup = document.createElement('div');
            popup.classList.add('popup');

            const popupContent = document.createElement('div');
            popupContent.classList.add('popup-content');

            const messageElement = document.createElement('p');
            messageElement.textContent = message;

            popupContent.appendChild(messageElement);

            if (showForm) {
                const form = document.createElement('form');
                form.classList.add('popup-form');

                const input = document.createElement('input');
                input.type = 'text';
                input.placeholder = 'Enter details...';
                form.appendChild(input);

                const submitButton = document.createElement('button');
                submitButton.type = 'submit';
                submitButton.textContent = 'Submit';
                form.appendChild(submitButton);

                // Add event listener for form submission
                form.addEventListener('submit', (event) => {
                    event.preventDefault();
                    const inputValue = input.value.trim();

                    // Validation: Check if input is at least 10 digits and contains no spaces
                    if (inputValue.length < 10 || /\s/.test(inputValue)) {
                        showPopupMessage('Input must be at least 10 digits long and contain no spaces.', false, 2000);
                        return;
                    }

                    // Proceed with submission if validation passes
                    // (Your existing logic for handling the submission goes here)
                });

                popupContent.appendChild(form);
            }

            // Add back icon to close the popup
            const backIcon = document.createElement('span');
            backIcon.textContent = 'â†'; // You can replace this with an icon if needed
            backIcon.style.cursor = 'pointer';
            backIcon.style.fontSize = '20px';
            backIcon.style.marginBottom = '10px';
            backIcon.addEventListener('click', () => {
                popup.remove();
            });
            popupContent.prepend(backIcon); // Add back icon at the top of the popup content

            popup.appendChild(popupContent);
            document.body.appendChild(popup);

            popup.style.position = 'fixed';
            popup.style.top = '50%';
            popup.style.left = '50%';
            popup.style.transform = 'translate(-50%, -50%)';
            popup.style.backgroundColor = showForm ? 'lightgreen' : 'white';
            popup.style.color = 'black';
            popup.style.padding = '20px'; 
            popup.style.border = '1px solid black';
            popup.style.zIndex = '1000';
            popup.style.maxWidth = '90%';
            popup.style.boxSizing = 'border-box';

            popupContent.style.display = 'flex';
            popupContent.style.flexDirection = 'column';
            popupContent.style.alignItems = 'center';

            if (removeAfter > 0) {
                setTimeout(() => {
                    popup.remove();
                }, removeAfter);
            }
        }

     // async function to check user's deposit and update electronic value
async function checkUserDeposits(userId) {
    try {
        const response = await fetch('/check-deposit', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ userId: userId }),
        });

        const data = await response.json();

        if (response.ok) {
            const electronicCents = Math.round(data.electronic * 100); // Convert electronic value to cents
            localStorage.setItem('electronic', electronicCents); // Store the value in localStorage
            displayElectronicValue(); // Call function to display the updated value
        } else {
            alert(data.error || 'An error occurred while checking your deposit status.');
        }
    } catch (error) {
        alert('An error occurred while checking your deposit status. Please try again later.');
    }
}

// Function to display the electronic value in dollars and cents
function displayElectronicValue() {
    const electronic = parseInt(localStorage.getItem('electronic')) || 0; // Get electronic value from localStorage
    let electronicDollars = Math.floor(electronic / 100); // Extract dollars part
    let electronicCents = electronic % 100; // Extract cents part
    // Display value in format electronic: dollars.cents (e.g., electronic: 50.05)
    document.getElementById('electronic').textContent = `Electronic: ${electronicDollars}.${electronicCents < 10 ? '0' + electronicCents : electronicCents}`;
}

    </script>
   

</body>

</html>