<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dray Source</title>
    <link rel="stylesheet" href="css/style.css">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
</head>

<body>
    <header class="Header">
        <div class="header-container">
            <div class="item"> <span id="electronic" class="money-color">0</span> <br> Team </div>
            <div class="item"><span class="money-color" id="money">0</span> <br> All above </div>
        </div>
    </header>
    <main>
        <div class="main-container">
            <div class="second-main-container">
                <div class="item box" data-cost="9000">
                    <h2 class="package-title"><i class='bx bx-candles' style='color:gold'></i>Reliable Investmant<i
                            class='bx bx-candles' style='color:gold'></i></h2>
                    <p class="rank-buying">Copper Investmant</p>
                    <div class="buying-details">
                        <div class="info">Max 300<br><span class="details">Daily limit</span></div>
                        <div class="info">90 Days <br><span class="details">Expire Time</span></div>
                        <div class="info">0.1 USDT <br><span class="details">Working income</span></div>
                    </div>
                    <div class="items click"><a href="#">90 USDT Open now</a></div>
                </div>
                <div class="item1 box" data-cost="18000">
                    <p class="rank-buying">Ivory Investmant</p>
                    <div class="buying-details">
                        <div class="info">Max 600 <br><span class="details">Daily limit</span></div>
                        <div class="info">90 Days <br><span class="details">Expire Time</span></div>
                        <div class="info">0.5 USDT-cent <br><span class="details">Working income</span></div>
                    </div>
                    <div class="items click"><a href="#">180 USDT Open now</a></div>
                </div>
                <div class="item2 box" data-cost="30000">
                    <p class="rank-buying">Amber Investmant</p>
                    <div class="buying-details">
                        <div class="info">Max 1200 <br><span class="details">Daily limit</span></div>
                        <div class="info">90 Days <br><span class="details">Expire Time</span></div>
                        <div class="info">0.83 USDT-cent<br><span class="details">Working income</span></div>
                    </div>
                    <div class="items click"><a href="#">300 USDT Open now</a></div>
                </div>
                <div class="item3 box" data-cost="60000">
                    <p class="rank-buying">Cedar Investmant</p>
                    <div class="buying-details">
                        <div class="info">Max 1200 <br><span class="details">Daily limit</span></div>
                        <div class="info">90 Days <br><span class="details">Expire Time</span></div>
                        <div class="info">1.66 USDT-cent<br><span class="details">Working income <br>
                                Comeing soon</span></div>
                    </div>
                    <div class="items click"><a href="#">600 USDT Open now</a></div>
                </div>
                <div class="item4 box" data-cost="120000">
                    <p class="rank-buying">Tritium Investmant</p>
                    <div class="buying-details">
                        <div class="info">Max 1200 <br><span class="details">Daily limit</span></div>
                        <div class="info">90 Days <br><span class="details">Expire Time</span></div>
                        <div class="info">3.33 USDT-cent<br><span class="details">Working income<br>
                                Comeing soon</span></div>
                    </div>
                    <div class="items click"><a href="#">1200 USDT Open now</a></div>
                </div>
                <div class="item4 box" data-cost="240000">
                    <p class="rank-buying">Incense Investmant</p>
                    <div class="buying-details">
                        <div class="info">Max 1200 <br><span class="details">Daily limit</span></div>
                        <div class="info">90 Days <br><span class="details">Expire Time</span></div>
                        <div class="info">6.66 USDT-cent<br><span class="details">Working income <br>
                                Comeing soon</span></div>
                    </div>
                    <div class="items click"><a href="#">2400 USDT Open now</a></div>
                </div>
                <div class="item5 box" style="margin-bottom: 8.5vh;" data-cost="300000">
                    <p class="rank-buying">Antimatter Investmant (Mega Chance)</p>
                    <div class="buying-details">
                        <div class="info">Max 1200 <br><span class="details">Daily limit</span></div>
                        <div class="info">90 Days <br><span class="details">Expire Time</span></div>
                        <div class="info">8.33 USDT-cent<br><span class="details">Working income<br>
                                Comeing soon</span></div>
                    </div>
                    <div class="items click"><a href="#">3000 USDT Open now</a></div>
                </div>

            </div>

        </div>
    </main>
    <footer class="container">
        <nav class="container-layer">
            <a href="/Home" class="clk"> <i class='bx bxs-home' style='color:#0c0400'></i><br>Home</a>
            <a href="/Connection" class="clk"><i class='bx bx-sitemap' style='color:#0c0b0b'></i><br>Network</a>
            <a href="/vip" class="clk vip-link"><i class='bx bxl-sketch' style='color:#0c0c0c'></i> <br> Invest </a>
            <a href="/mine" class="clk"><i class='bx bxs-user' style='color:#000400'></i><br> Owner</a>
            <a href="/about" class="clk"><i class='bx bx-shield' style='color:#0c0b0b'></i><br>About</a>
        </nav>
    </footer>
    <!-- <script>
//reopen
document.addEventListener('DOMContentLoaded', () => {
    const urlParams = new URLSearchParams(window.location.search);
    const vipuserId = urlParams.get('vipuserId');
    const packageCost = parseInt(urlParams.get('packageCost'));
    let electronic = parseInt(localStorage.getItem('electronic')) || 0;
    let score = parseInt(localStorage.getItem('score')) || 0;
    updateMoneyDisplay(score, electronic);

    // Get opened packages from localStorage
    const openPackages = JSON.parse(localStorage.getItem('openPackages')) || [];

    if (vipuserId) {
        document.querySelectorAll('.click').forEach(box => {
            const cost = parseInt(box.closest('.box').getAttribute('data-cost'));
            const packageOpened = openPackages.find(pkg => pkg.packageCost === cost);

            if (packageOpened) {
                fetchPackageStatus(vipuserId, cost, box, packageOpened);
            } else {
                box.innerHTML = `<a href="#">${cost} USDT Open now</a>`;
            }

            box.addEventListener('click', async (event) => {
                event.preventDefault();

                if (packageOpened) {
                    try {
                        const response = await fetch(`/check-package-status?userId=${vipuserId}&packageCost=${cost}`);
                        const data = await response.json();

                        if (data.error) {
                            alert('Error: ' + data.error);
                            return;
                        }

                        if (data.daysLeftFor90 === 0) {
                            // Reopen package logic
                            handlePackageReopen(vipuserId, cost, box, packageOpened);
                        } else {
                            window.location.href = `/income?vipuserId=${vipuserId}&packageCost=${cost}&isTodayRiched=${data.isTodayRiched ? 'true' : 'false'}`;
                        }
                    } catch (error) {
                        console.error('Error fetching package status:', error);
                    }
                } else {
                    openNewPackage(vipuserId, cost, electronic, score, openPackages);
                }
            });
        });
    }

    async function fetchPackageStatus(vipuserId, cost, box, packageOpened) {
        try {
            const response = await fetch(`/check-package-status?userId=${vipuserId}&packageCost=${cost}`);
            const data = await response.json();

            if (data.error) {
                alert('Error: ' + data.error);
                return;
            }

            const daysLeftFor90 = data.daysLeftFor90;

            if (daysLeftFor90 > 0) {
                box.innerHTML = `<p>Opened for you (${daysLeftFor90} days left)</p>`;
            } else {
                // Show "Reopen now" if the 90-day period has passed
                box.innerHTML = `<a href="#">${cost} USDT Reopen now</a>`;
            }
        } catch (error) {
            console.error('Error fetching package status:', error);
        }
    }

    function updateMoneyDisplay(score, electronic) {
        let scoreDollars = Math.floor(score / 100);
        let scoreCents = score % 100;
        document.getElementById('money').textContent = `${scoreDollars}.${scoreCents < 10 ? '0' + scoreCents : scoreCents}`;

        let electronicDollars = Math.floor(electronic / 100);
        let electronicCents = electronic % 100;
        document.getElementById('electronic').textContent = `${electronicDollars}.${electronicCents < 10 ? '0' + electronicCents : electronicCents}`;
    }

    function showReferralPrompt(vipuserId, cost, callback) {
        const referralPrompt = document.createElement('div');
        referralPrompt.innerHTML = `
            <div style="background-color: green; color: black; padding: 10px; border-radius: 5px; position: fixed; top: 40%; left: 50%; transform: translate(-50%, -50%); z-index: 1000;">
                <span id="backIcon" style="cursor: pointer; color: white; font-weight: bold; float: right;">&#10006;</span>
                <p style="color: gold;">Referred User ID</p>
                <input type="text" style="color: black;" id="referredUserId" placeholder="Enter user ID">
                <button id="submitReferral" style="background: linear-gradient(to right, #ff7e5f, #feb47b); color: white;">Submit</button>
            </div>
        `;

        document.body.appendChild(referralPrompt);

        document.getElementById('backIcon').addEventListener('click', () => {
            referralPrompt.remove();
        });

        document.getElementById('submitReferral').addEventListener('click', async () => {
            const referredUserId = document.getElementById('referredUserId').value;

            if (referredUserId) {
                if (referredUserId === vipuserId) {
                    alert('Owner user ID not able to get commission.');
                    return;
                }

                try {
                    const response = await fetch('/check-user-exists', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ referredUserId })
                    });

                    const data = await response.json();

                    if (!data.exists) {
                        alert('This user not found.');
                        return;
                    }

                    referralPrompt.innerHTML = '<p style="background-color: green; color: black;">Processing...</p>';

                    setTimeout(() => {
                        referralPrompt.remove();
                        callback(true, referredUserId);
                    }, 500);
                } catch (error) {
                    console.error('Error checking referred user:', error);
                }
            } else {
                alert('Please enter a User ID.');
                callback(false);
            }
        });
    }

    function openNewPackage(vipuserId, cost, electronic, score, openPackages) {
        if (electronic >= cost || score >= cost) {
            showReferralPrompt(vipuserId, cost, async (success, referredUserId) => {
                if (success) {
                    if (electronic >= cost) {
                        electronic -= cost;
                        localStorage.setItem('electronic', electronic);
                    } else {
                        score -= cost;
                        localStorage.setItem('score', score);
                    }

                    updateMoneyDisplay(score, electronic);

                    const newPackage = { packageCost: cost, lastOpened: Date.now(), referredUserId };
                    openPackages.push(newPackage);
                    localStorage.setItem('openPackages', JSON.stringify(openPackages));

                    // Send the opened package data to the server
                    await fetch('/save-opened-package', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            userId: vipuserId,
                            packageCost: cost,
                            referredUserId,
                            updatedElectronic: electronic,
                        })
                    });

                    window.location.href = `/income?vipuserId=${vipuserId}&packageCost=${cost}&isTodayRiched=false`;
                }
            });
        } else {
            alert('Insufficient funds to open this package.');
        }
    }

    function handlePackageReopen(vipuserId, cost, box, packageOpened) {
        if (electronic >= cost || score >= cost) {
            showReferralPrompt(vipuserId, cost, async (success, referredUserId) => {
                if (success) {
                    if (electronic >= cost) {
                        electronic -= cost;
                        localStorage.setItem('electronic', electronic);
                    } else {
                        score -= cost;
                        localStorage.setItem('score', score);
                    }

                    updateMoneyDisplay(score, electronic);

                    // Update package in local storage with a new open time
                    packageOpened.lastOpened = Date.now();
                    packageOpened.referredUserId = referredUserId;
                    localStorage.setItem('openPackages', JSON.stringify(openPackages));

                    // Send the reopened package data to the server
                    await fetch('/save-reopened-package', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            userId: vipuserId,
                            packageCost: cost,
                            referredUserId,
                            updatedElectronic: electronic,
                        })
                    });

                    window.location.href = `/income?vipuserId=${vipuserId}&packageCost=${cost}&isTodayRiched=false`;
                }
            });
        } else {
            alert('Insufficient funds to reopen this package.');
        }
    }
    // Link to VIP user page
    document.querySelector('.vip-link').addEventListener('click', (event) => {
        event.preventDefault();
        const vipuserId = localStorage.getItem('userId');

        if (vipuserId) {
            window.location.href = `/vip?vipuserId=${vipuserId}`;
        } else {
            alert('Invalid user ID');
        }
    });
});
</script>  -->

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const vipuserId = urlParams.get('vipuserId');
            const packageCost = parseInt(urlParams.get('packageCost'));
            let electronic = parseInt(localStorage.getItem('electronic')) || 0;
            let score = parseInt(localStorage.getItem('score')) || 0;
            updateMoneyDisplay(score, electronic);

            // Get opened packages from localStorage
            const openPackages = JSON.parse(localStorage.getItem('openPackages')) || [];
            if (vipuserId) {
                document.querySelectorAll('.click').forEach(box => {
                      const cost = parseInt(box.closest('.box').getAttribute('data-cost'));
            const packageOpened = openPackages.find(pkg => pkg.packageCost === cost);

                    if (packageOpened) {
                        fetchPackageStatus(vipuserId, cost, box, packageOpened);
                    } else {
                        box.innerHTML = `<a href="#">${cost} USDT Open now</a>`;
                    }

                    box.addEventListener('click', async (event) => {
                        event.preventDefault();

                        if (packageOpened) {
                            try {
                                const response = await fetch(`/check-package-status?userId=${vipuserId}&packageCost=${cost}`);
                                const data = await response.json();

                                if (data.error) {
                                    alert('Error: ' + data.error);
                                    return;
                                }

                                window.location.href = `/income?vipuserId=${vipuserId}&packageCost=${cost}&isTodayRiched=${data.isTodayRiched ? 'true' : 'false'}`;
                            } catch (error) {
                                console.error('Error fetching package status:', error);
                            }
                        } else {
                            if (electronic >= cost || score >= cost) {
                                showReferralPrompt(vipuserId, cost, async (success, referredUserId) => {
                                    if (success) {
                                        if (electronic >= cost) {
                                            electronic -= cost;
                                            localStorage.setItem('electronic', electronic);
                                        } else {
                                            score -= cost;
                                            localStorage.setItem('score', score);
                                        }

                                        updateMoneyDisplay(score, electronic);

                                        const newPackage = { packageCost: cost, lastOpened: Date.now(), referredUserId };
                                        openPackages.push(newPackage);
                                        localStorage.setItem('openPackages', JSON.stringify(openPackages));

                                        // Send the opened package data to the server
                                        await fetch('/save-opened-package', {
                                            method: 'POST',
                                            headers: { 'Content-Type': 'application/json' },
                                            body: JSON.stringify({
                                                userId: vipuserId,
                                                packageCost: cost,
                                                referredUserId,
                                                updatedElectronic: electronic,
                                            })
                                        });

                                        window.location.href = `/income?vipuserId=${vipuserId}&packageCost=${cost}&isTodayRiched=false`;
                                    }
                                }); 
                            } else {
                                alert('Insufficient funds to open this package.');
                            }
                        }
                    });
                });
            }

            // Fetch package status and display daysLeftFor90 accordingly
            async function fetchPackageStatus(vipuserId, cost, box, packageOpened) {
                try {
                    const response = await fetch(`/check-package-status?userId=${vipuserId}&packageCost=${cost}`);
                    const data = await response.json();

                    if (data.error) {
                        alert('Error: ' + data.error);
                        return;
                    }

                    const daysLeftFor90 = data.daysLeftFor90;

                    if (daysLeftFor90 > 0) {
                        box.innerHTML = `<p>Opened for you (${daysLeftFor90} days left)</p>`;
                    } else {
                        box.innerHTML = `<a href="#">${cost} USDT Open now</a>`;
                    }
                } catch (error) {
                    console.error('Error fetching package status:', error);
                }
            }

            function updateMoneyDisplay(score, electronic) {
                let scoreDollars = Math.floor(score / 100);
                let scoreCents = score % 100;
                document.getElementById('money').textContent = `${scoreDollars}.${scoreCents < 10 ? '0' + scoreCents : scoreCents}`;

                let electronicDollars = Math.floor(electronic / 100);
                let electronicCents = electronic % 100;
                document.getElementById('electronic').textContent = `${electronicDollars}.${electronicCents < 10 ? '0' + electronicCents : electronicCents}`;
            }

            function showReferralPrompt(vipuserId, cost, callback) {
                const referralPrompt = document.createElement('div');
                referralPrompt.innerHTML = `
            <div style="background-color: green; color: black; padding: 10px; border-radius: 5px; position: fixed; top: 40%; left: 50%; transform: translate(-50%, -50%); z-index: 1000;">
                <span id="backIcon" style="cursor: pointer; color: white; font-weight: bold; float: right;">&#10006;</span>
                <p style="color: gold;">Referred User ID</p>
                <input type="text" style="color: black;" id="referredUserId" placeholder="Enter user ID">
                <button id="submitReferral" style="background: linear-gradient(to right, #ff7e5f, #feb47b); color: white;">Submit</button>
            </div>
        `;

                document.body.appendChild(referralPrompt);

                document.getElementById('backIcon').addEventListener('click', () => {
                    referralPrompt.remove();
                });

                document.getElementById('submitReferral').addEventListener('click', async () => {
                    const referredUserId = document.getElementById('referredUserId').value;

                    if (referredUserId) {
                        if (referredUserId === vipuserId) {
                            alert('Owner user ID not able to get commission.');
                            return;
                        }

                        try {
                            const response = await fetch('/check-user-exists', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({ referredUserId })
                            });

                            const data = await response.json();

                            if (!data.exists) {
                                alert('This user not found.');
                                return;
                            }

                            referralPrompt.innerHTML = '<p style="background-color: green; color: black;">Processing...</p>';

                            setTimeout(() => {
                                referralPrompt.remove();
                                callback(true, referredUserId);
                            }, 500);
                        } catch (error) {
                            console.error('Error checking referred user:', error);
                        }
                    } else {
                        alert('Please enter a User ID.');
                        callback(false);
                    }
                });
            }

            // Link to VIP user page
            document.querySelector('.vip-link').addEventListener('click', (event) => {
                event.preventDefault();
                const vipuserId = localStorage.getItem('userId');

                if (vipuserId) {
                    window.location.href = `/vip?vipuserId=${vipuserId}`;
                } else {
                    alert('Invalid user ID');
                }
            });
        }); 
    </script>


</body>

</html>